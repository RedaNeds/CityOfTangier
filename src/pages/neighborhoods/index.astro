---
import NeighborhoodLayout from '../../layouts/NeighborhoodLayout.astro';
import NeighborhoodCard from '../../components/CartesListes/NeighborhoodCard.astro';
import { client, queries } from '../../lib/sanity';
import type { SanityNeighborhood } from '../../lib/sanity';

// Get all neighborhoods from Sanity with error handling
let neighborhoods: SanityNeighborhood[] = [];

try {
  neighborhoods = await client.fetch(`
    *[_type == "neighborhood"] | order(publishedAt desc) {
      _id,
      title,
      slug,
      description,
      featuredImage {
        asset->{
          _id,
          url
        },
        alt
      },
      location {
        coordinates,
        bounds
      },
      characteristics,
      places,
      tags,
      featured,
      publishedAt
    }
  `) as SanityNeighborhood[];
} catch (error) {
  console.error('Error fetching neighborhoods from Sanity:', error);
  neighborhoods = [];
}

// Get featured neighborhoods
const featuredNeighborhoods = neighborhoods.filter(n => n.featured);

// Get regular neighborhoods
const regularNeighborhoods = neighborhoods.filter(n => !n.featured);
---

<NeighborhoodLayout 
  title="Neighborhoods in Tangier - Explore Each Area's Unique Character"
  description="Discover Tangier's diverse neighborhoods, from the historic Kasbah to the modern City Center. Each area offers its own charm, attractions, and experiences."
>
  <div class="max-w-7xl mx-auto px-4 py-16">
    <!-- Header -->
    <div class="text-center mb-16">
      <h1 class="text-4xl md:text-5xl font-display font-bold text-dark-brown mb-6">
        Explore Tangier by Neighborhood
      </h1>
      <p class="text-xl text-warm-gray font-primary max-w-3xl mx-auto leading-relaxed">
        Each neighborhood in Tangier has its own unique character, history, and attractions. 
        Discover the distinct personality of each area and find the perfect spots for your visit.
      </p>
    </div>

    <!-- Featured Neighborhoods -->
    {featuredNeighborhoods.length > 0 && (
      <section class="mb-16">
        <div class="flex items-center justify-between mb-8">
          <h2 class="text-3xl font-display font-bold text-dark-brown">Featured Neighborhoods</h2>
          <div class="w-16 h-1 bg-strait-blue rounded-full"></div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {featuredNeighborhoods.map((neighborhood) => (
            <NeighborhoodCard neighborhood={neighborhood} featured={true} />
          ))}
        </div>
      </section>
    )}

    <!-- All Neighborhoods -->
    <section>
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-3xl font-display font-bold text-dark-brown">All Neighborhoods</h2>
        <div class="w-16 h-1 bg-strait-blue rounded-full"></div>
      </div>

      {regularNeighborhoods.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
          {regularNeighborhoods.map((neighborhood) => (
            <NeighborhoodCard neighborhood={neighborhood} />
          ))}
        </div>
      ) : (
        <div class="text-center py-16">
          <div class="text-6xl mb-4">üèòÔ∏è</div>
          <h3 class="text-xl font-semibold text-gray-900 mb-2">No neighborhoods found</h3>
          <p class="text-gray-600">Check back later for neighborhood listings.</p>
        </div>
      )}
    </section>

    <!-- Call to Action -->
    <section class="mt-16 bg-gradient-to-br from-strait-blue via-kasbah-navy to-teal rounded-2xl p-12 text-center text-white">
      <h2 class="text-3xl font-display font-bold mb-4">Ready to Explore?</h2>
      <p class="text-xl mb-8 opacity-90">
        Use our interactive map to discover places in each neighborhood
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a 
          href="/map" 
          class="bg-white text-strait-blue px-8 py-4 rounded-xl font-semibold hover:bg-gray-100 transition-colors"
        >
          View Interactive Map
        </a>
        <a 
          href="/itineraries" 
          class="border-2 border-white text-white px-8 py-4 rounded-xl font-semibold hover:bg-white hover:text-strait-blue transition-colors"
        >
          Plan Your Itinerary
        </a>
      </div>
    </section>
  </div>
</NeighborhoodLayout>



